{% extends "base.html" %}
{% block title %}Select Deviations - HAZOP Analysis{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Select Deviations for Analysis</h2>
    <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> Back to Items
    </a>
</div>

<!-- Summary -->
<div class="row mb-4">
    <div class="col-md-4">
        <div class="card text-center border-primary">
            <div class="card-body">
                <h5 class="card-title text-primary">{{ items.major_equipment | length }}</h5>
                <p class="card-text text-muted mb-0">Major Equipment</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-center border-primary">
            <div class="card-body">
                <h5 class="card-title text-primary">{{ items.instruments_causes | length }}</h5>
                <p class="card-text text-muted mb-0">Instruments / Causes</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-center border-primary">
            <div class="card-body">
                <h5 class="card-title text-primary">{{ items.safety_devices | length }}</h5>
                <p class="card-text text-muted mb-0">Safety Devices</p>
            </div>
        </div>
    </div>
</div>

<!-- Deviation Checkboxes -->
<div class="card">
    <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-list-check"></i> Process Deviations</h5>
    </div>
    <div class="card-body">
        <div class="row g-3" id="deviationGrid">
            <div class="col-md-6">
                <div class="form-check deviation-check">
                    <input class="form-check-input" type="checkbox" value="High Pressure" id="dev1">
                    <label class="form-check-label" for="dev1">High Pressure</label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-check deviation-check">
                    <input class="form-check-input" type="checkbox" value="Low Pressure" id="dev2">
                    <label class="form-check-label" for="dev2">Low Pressure</label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-check deviation-check">
                    <input class="form-check-input" type="checkbox" value="High Level" id="dev3">
                    <label class="form-check-label" for="dev3">High Level</label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-check deviation-check">
                    <input class="form-check-input" type="checkbox" value="Low Level" id="dev4">
                    <label class="form-check-label" for="dev4">Low Level</label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-check deviation-check">
                    <input class="form-check-input" type="checkbox" value="High Temperature" id="dev5">
                    <label class="form-check-label" for="dev5">High Temperature</label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-check deviation-check">
                    <input class="form-check-input" type="checkbox" value="Low Temperature" id="dev6">
                    <label class="form-check-label" for="dev6">Low Temperature</label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-check deviation-check">
                    <input class="form-check-input" type="checkbox" value="No/Low Flow" id="dev7">
                    <label class="form-check-label" for="dev7">No/Low Flow</label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-check deviation-check">
                    <input class="form-check-input" type="checkbox" value="More/High Flow" id="dev8">
                    <label class="form-check-label" for="dev8">More/High Flow</label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-check deviation-check">
                    <input class="form-check-input" type="checkbox" value="Reverse/Misdirected Flow" id="dev9">
                    <label class="form-check-label" for="dev9">Reverse/Misdirected Flow</label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-check deviation-check">
                    <input class="form-check-input" type="checkbox" value="Tube Leak" id="dev10">
                    <label class="form-check-label" for="dev10">Tube Leak</label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-check deviation-check">
                    <input class="form-check-input" type="checkbox" value="Composition/Contamination" id="dev11">
                    <label class="form-check-label" for="dev11">Composition/Contamination</label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-check deviation-check">
                    <input class="form-check-input" type="checkbox" value="Leaks (Corrosion/Erosion)" id="dev12">
                    <label class="form-check-label" for="dev12">Leaks (Corrosion/Erosion, etc.)</label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-check deviation-check">
                    <input class="form-check-input" type="checkbox" value="Human Factors" id="dev13">
                    <label class="form-check-label" for="dev13">Human Factors</label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-check deviation-check">
                    <input class="form-check-input" type="checkbox" value="Previous Incidents/Learnings" id="dev14">
                    <label class="form-check-label" for="dev14">Previous Incidents/Learnings</label>
                </div>
            </div>
            <div class="col-12">
                <div class="form-check deviation-check d-flex align-items-center">
                    <input class="form-check-input me-2" type="checkbox" value="Other" id="devOther">
                    <label class="form-check-label me-3" for="devOther">Other:</label>
                    <input type="text" class="form-control form-control-sm" id="otherText"
                           placeholder="Specify other deviation..." disabled style="max-width: 400px;">
                </div>
            </div>
        </div>
    </div>
</div>

<button id="submitDeviations" class="btn btn-success btn-lg w-100 mt-4">
    <i class="bi bi-check-lg"></i> Submit Deviations
</button>

<!-- Loading Overlay -->
<div id="loadingOverlay" class="loading-overlay d-none">
    <div class="text-center">
        <div class="spinner-border text-primary mb-3" style="width: 3rem; height: 3rem;" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <h4>Generating Causes...</h4>
        <p class="text-muted">Claude is analyzing instruments for each deviation. This may take a minute.</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/deviations.js') }}"></script>
{% endblock %}
